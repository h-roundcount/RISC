---
title: "dem_index_plot"
---

```{r}
library(ggplot2)
library(ERT)
library(dplyr)
library(plotly)
library(htmlwidgets)
```

```{r}
ert<- read.csv("ert.csv")
ert_df <- data_frame(ert)

make_plot_function <- function(country) {

  ert_df_country <- ert_df |>
    filter(country_name == country)

dem_index_plot <- ggplot(data = ert_df_country, aes(x=year, y=v2x_polyarchy))+
  geom_line(color = "darkslategray") +
   geom_smooth( orientation= "x", color = "darkslategray1") +
  xlab("Year") + ylab("EDI Score") +
  theme_bw() + scale_x_continuous(n.breaks = 10)

return(ggplotly(dem_index_plot))

}

countries <- unique(vdem$country_name)



for (c in countries) {

  tryCatch(
    expr = {
  p <- make_plot_function(country = c)

  htmlwidgets::saveWidget(
    p,
    file = paste0("plot/dem_index/", gsub(" ", "_", c), ".html"),
    selfcontained = TRUE
  )
    },
  error = function(e) {
    print("No data found.")
  })
}

'''

